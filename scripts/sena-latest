#!/bin/bash
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"

SENA_DEV="$PROJECT_DIR/target/release/sena"
SENA_INSTALLED="$HOME/.local/bin/sena"
SENA_CARGO="$HOME/.cargo/bin/sena"

if [[ -x "$SENA_DEV" ]]; then
    if [[ -x "$SENA_INSTALLED" ]]; then
        DEV_VER=$("$SENA_DEV" --version 2>/dev/null | awk '{print $2}')
        INST_VER=$("$SENA_INSTALLED" --version 2>/dev/null | awk '{print $2}')
        if [[ "$DEV_VER" != "$INST_VER" ]]; then
            echo "Warning: Version mismatch (dev=$DEV_VER, installed=$INST_VER)" >&2
            echo "Run 'make install' in project directory to sync" >&2
        fi
    fi
    exec "$SENA_DEV" "$@"
elif [[ -x "$SENA_INSTALLED" ]]; then
    exec "$SENA_INSTALLED" "$@"
elif [[ -x "$SENA_CARGO" ]]; then
    exec "$SENA_CARGO" "$@"
elif command -v sena &>/dev/null; then
    exec sena "$@"
else
    echo "Error: sena binary not found" >&2
    exit 1
fi
